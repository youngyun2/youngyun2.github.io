---
title: manacher å­¦ä¹ ç¬”è®°
tags: [åŸåˆ›]
categories: [ç®—æ³•]
date: 2025-8-10
description: ğŸ™„
articleGPT: ï¼
---

## å‰è¨€
æ˜¯æœ‰ä¸€å †æ°´è“çš„ [manacher](https://oi-wiki.org/string/manacher/)ï¼ï¼ˆçœŸçš„æ¯” [kmp](https://oi-wiki.org/string/kmp/) ç®€å•ï¼‰

## ç®€ä»‹
è¯¥ç®—æ³•ç”± **Glenn K. Manache** åœ¨ 1975 å¹´æå‡ºï¼Œåœ¨è§£å†³å›æ–‡ä¸²é—®é¢˜ä¸Šæœ‰éå¸¸ä¼˜ç§€çš„è¡¨ç°ï¼Œç é‡å¾ˆçŸ­ä¸”æ—¶é—´ä¸ç©ºé—´å¤æ‚åº¦çš„å¸¸æ•°æ›´å°ã€‚ç»å¸¸è¢« OIer ä»¬æˆç§°ä¸º**é©¬æ‹‰è½¦**ã€‚

## å®ç°
ä»¥[æ¨¡æ¿é¢˜](https://www.luogu.com.cn/problem/P3805)ä¸ºä¾‹ã€‚

é¢˜æ„éå¸¸ç®€å•æ˜äº†ï¼Œå°±æ˜¯æ±‚ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æœ€é•¿å›æ–‡ä¸²çš„é•¿åº¦ï¼Œä¸çŸ¥é“å›æ–‡ä¸²æ˜¯ä»€ä¹ˆçš„å¯ä»¥æ´—æ´—ç¡äº†ã€‚

### æœ´ç´ æš´åŠ›
æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯ $O(n^2)$ æš´åŠ›æšä¸¾å­—ä¸²çš„èŒƒå›´ï¼Œå† $O(n)$ åˆ¤æ–­æ˜¯å¦æ˜¯å›æ–‡ä¸²ï¼Œæ€»çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(n^3)$ï¼Œç„¶åæˆ‘ä»¬å°±è·å¾—äº† 18 pt çš„â€œå¥½æˆç»©â€ã€‚

[æäº¤è®°å½•](https://www.luogu.com.cn/record/230080939)ã€‚

### ä¸­å¿ƒæ‰©å±•æ³•
è¿™ç§æš´åŠ›çš„æ ¸å¿ƒåŸç†å°±æ˜¯åˆ†ç±»è®¨è®ºå›æ–‡ä¸²é•¿åº¦çš„å¥‡å¶æ€§ï¼ŒæŠŠå­—ç¬¦ä¸²çš„æ¯ä¸ªå­—ç¬¦æˆ–æ¯ä¸¤ä¸ªç›¸åŒçš„å­—ç¬¦çœ‹ä½œä¸­å¿ƒï¼Œç„¶åå·¦å³æ‰©å±•æ£€æŸ¥ï¼Œåˆ¤æ–­å®ƒå·¦å³çš„å¯¹ç§°ä½ç½®æ˜¯å¦ç›¸åŒï¼Œè‹¥ç›¸åŒï¼Œåˆ™æ˜¯å›æ–‡çš„ä¸€éƒ¨åˆ†ï¼Œç›´åˆ°å¯¹ç§°ä½ç½®ä¸åŒä¸ºæ­¢ã€‚

è¿™ç§æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(n^2)$ï¼Œç¨å¾®å¥½äº†ä¸€ç‚¹ï¼Œ66 ptã€‚

[æäº¤è®°å½•](https://www.luogu.com.cn/record/230083188)ã€‚

### manacher
è¿›å…¥æ­£é¢˜ï¼Œå¯ä»¥å‘ç°é¢˜ç›®çš„æ•°æ®èŒƒå›´ä¸º $1\le n\le 1.1Ã—10^7$ï¼Œè€ƒè™‘ $O(n)$ å®ç°ã€‚

æˆ‘ä»¬ç®€å•åšä¸€äº›å®šä¹‰ã€‚

**åŸä¸² S**ï¼šè¯»å…¥çš„å­—ç¬¦ä¸² Sã€‚  

**æ‰©å±•ä¸² T**ï¼šåœ¨ S çš„æ¯ä¸ªå­—ç¬¦å·¦å³æ’äººä¸€ä¸ª**ä¸å±äº** S çš„å­—ç¬¦ï¼Œå¦‚`#`ï¼Œè®°ä¸ºå­—ç¬¦ä¸² Tï¼Œè¿™æ ·è½¬æ¢çš„ç›®çš„æ˜¯ä¸ç”¨è€ƒè™‘å¶æ•°é•¿åº¦çš„å›æ–‡ä¸²ã€‚

ä¾‹å­ï¼š
```
Sï¼šabcba  
Tï¼š#a#b#c#b#a#
```
**å›æ–‡ä¸­å¿ƒ c**ï¼šåœ¨æ‰©å±•ä¸² T ä¸­ï¼Œä»¥å­—ç¬¦ c ä½œä¸ºå›æ–‡ä¸²çš„ä¸­å¿ƒã€‚

**å›æ–‡åŠå¾„æ•°ç»„P**ï¼š$P_i$ è¡¨ç¤ºä»¥å­—ç¬¦ T[i] ä¸ºå›æ–‡ä¸­å¿ƒçš„æœ€é•¿å›æ–‡çš„**åŠå¾„**ã€‚

å·ä¸€å¼ è®²ä¹‰ä¸Šçš„å›¾ï¼š

![](https://cdn.luogu.com.cn/upload/image_hosting/d8l1nf9o.png)

manacher çš„å®ç°éš¾åº¦ä¸å¤§ï¼Œä¸­å¿ƒæ‰©å±•æ³•ä½æ•ˆçš„åŸå› æ˜¯æœ‰é‡å¤çš„æ£€æŸ¥ï¼Œmanacherç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯åˆ©ç”¨**å›æ–‡çš„é•œåƒä¹Ÿæ˜¯å›æ–‡**è¿™ä¸ªç‰¹å¾å‡å°‘é‡å¤æ£€æŸ¥ã€‚

~~æ˜¯ä¸æ˜¯æœ‰ç‚¹æŠ½è±¡~~ï¼ŒåŒæ ·æŒ‚å¼ å›¾ã€‚

![](https://cdn.luogu.com.cn/upload/image_hosting/xx8muyrn.png)

å›¾ä¸­ i ä¸ j å…³äº $c$ å¯¹ç§°ï¼Œè‹¥ i ä¸ºå›æ–‡ä¸²ï¼Œé‚£ä¹ˆ j ä¹Ÿä¸€å®šä¸ºå›æ–‡ä¸²ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§è¿›è¡Œä¼˜åŒ–ã€‚

ä¸ºäº†å¿«é€Ÿè®¡ç®—ï¼Œæˆ‘ä»¬è®°å·²æ‰¾åˆ°çš„æœ€é å³çš„å­å›æ–‡ä¸²çš„è¾¹ç•Œ $r$ï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºæˆæ˜¯å– T çš„å‰ $i$ ä¸ªç‚¹ä¸­ä¸‹å›æ–‡åŠå¾„èƒ½å¤Ÿå‘å³å»¶ä¼¸çš„æœ€å¤§ä¸‹æ ‡ã€‚

ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬å®šä¹‰ $i$ å…³äº $c$ çš„å¯¹ç§°ç‚¹ä¸º $d$ï¼Œä¸”æ˜“å¾— $d=2\times c-i$ã€‚

$p_i$ çš„æ±‚è§£éœ€è¦åˆ†ç±»è®¨è®ºä¸€ä¸‹ã€‚

- å¯¹äº $i>r$ï¼Œæš´åŠ›æ±‚è§£ $p_i$
- å¯¹äº $i\le r$ï¼Œ  
	  ![](https://cdn.luogu.com.cn/upload/image_hosting/80mmdxp6.png)

æ³¨ï¼šè¿™é‡Œæœ¬æ¥æ˜¯ Latex æ ¼å¼çš„ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆç‚¸äº†ï¼Œåªèƒ½æŒ‚ä¸ªå›¾ã€‚

æœ‰ç‚¹æŠ½è±¡ï¼ŒæŒ‚ä¸€æ®µæ ¸å¿ƒä»£ç è¾…åŠ©ç†è§£ï¼Œå¯ä»¥æŒ‰éœ€ä¿®æ”¹
```cpp
for(int i=2;i<t.size()-1;i++){
    if(i<=r)p[i]=min(p[2*mi-i],r-i+1);
    else p[i]=1;
    while(t[i-p[i]]==t[i+p[i]])
        p[i]++;
    if(i+p[i]>r)mi=i,r=i+p[i]-1;
    an=max(an,p[i]);
}
```

## å®Œæ•´ä»£ç ï¼š
```cpp
#include<bits/stdc++.h>
#define int long long
#define endl "\n"
using namespace std;
int n,p[22000007],mi,r,an,l;
string s,t;
signed main()
{
	ios::sync_with_stdio(0);
	cin.tie(0);
	cout.tie(0);
	cin>>s;
	t+="^!#";
	for(int i=0;i<s.length();i++)
		t+=s[i],t+='#';
	t+='$';
	for(int i=2;i<t.size()-1;i++){
		if(i<=r)p[i]=min(p[2*mi-i],r-i+1);
		else p[i]=1;
		while(t[i-p[i]]==t[i+p[i]])
			p[i]++;
		if(i+p[i]>r)mi=i,r=i+p[i]-1;
		an=max(an,p[i]);
	}
    cout<<an-1;
	return 0;
}
```

[å€Ÿç”¨ WL å¤§ä½¬çš„ä¾‹é¢˜å‚è€ƒä»£ç ](https://www.luogu.com/article/fh4izofe)ï¼Œéœ€è¦é¢˜ç›®çš„é‡Œé¢ä¹Ÿæœ‰ä¸€äº›ã€‚

## å‚è€ƒèµ„æ–™
- è€å¸ˆå‘çš„è®²ä¹‰
- [OI Wiki](https://oi-wiki.org/string/manacher/)
- æ–‡ç« å¹¿åœºçš„éƒ¨åˆ†åšå®¢ï¼š
  - https://www.luogu.com.cn/article/rs0bgnw5
  - https://www.luogu.com.cn/article/nj5k91wu
  - https://www.luogu.com.cn/article/5plkunsd
