---
title: Splayyyyyyyyyyyyy å­¦ä¹ ç¬”è®°
tags: [åŸåˆ›]
categories: [ç®—æ³•]
date: 2025-7-24
description: ğŸ‘
articleGPT: ã€‚
---
æ‹‰ä¼¸ï¼

![](https://cdn.luogu.com.cn/upload/image_hosting/0pjb8m3y.png)

ï¼ˆSplay æ ‘åˆç§°ä¼¸å±•æ ‘ï¼Œæ‰€ä»¥æ‹‰ä¼¸ï¼‰

æ¶å¿ƒäººçš„ä¸œè¥¿ï¼Œå†™å‡ºæ¥æ¯” [fhq treap](http://tsh1203.github.io/posts/2024/1029) é•¿äº† 30 è¡Œï¼Œä½†æ˜¯æ¯”æŸåç¼€æ•°ç»„å¥½å­¦å¾—å¤šã€‚

## å®šä¹‰

Splay æ ‘åˆç§°ä¼¸å±•æ ‘ï¼ˆä¸Šæ–‡æåˆ°äº†ï¼‰ï¼Œæ˜¯ä¸€ç§å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œç”± Daniel Sleator å’Œ Robert Tarjan äº 1985 å¹´å‘æ˜ã€‚

Splay æ ‘æ ¸å¿ƒåŸç†æ˜¯é€šè¿‡ä¼¸å±•æ“ä½œå°†æŸä¸ªèŠ‚ç‚¹æ—‹è½¬åˆ°æ ¹èŠ‚ç‚¹ï¼Œä½¿å¾—ä»–èƒ½å¤Ÿåœ¨å‡æ‘Š $O(\log n)$ çš„æ—¶é—´å¤æ‚åº¦å†…å®Œæˆå¹³è¡¡æ ‘å¾—è‹¥å¹²æ“ä½œã€‚

ä¸ºäº†ä½¿ Splay æ ‘ä¿æŒå¹³è¡¡ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œæ—‹è½¬æ“ä½œï¼ˆæŠ½è±¡è‡³æï¼‰ï¼Œå°†æŸä¸ªç‚¹å‘ä¸Šç§»åŠ¨ä¸€ä¸ªä½ç½®ï¼Œå¹¶ä¸”ä¿æŒ Splay çš„äºŒå‰æœç´¢æ ‘æ€§è´¨ä¸å˜ã€‚

## åŸºæœ¬æ“ä½œ
æ—‹è½¬åˆ†ä¸ºå·¦æ—‹å’Œå³æ—‹ï¼Œä½†æœ¬è´¨ä¸Šæ²¡ä»€ä¹ˆåŒºåˆ«ã€‚

è®¾å½“å‰ç»“ç‚¹ä¸º xï¼Œçˆ¶äº²ç»“ç‚¹æ˜¯ yï¼Œy çš„çˆ¶äº²ä¸º zï¼Œä¸”æ—‹è½¬æ˜¯å³æ—‹ï¼š
1. æ›´æ–°çˆ¶äº²ä¸å„¿å­ä¿¡æ¯ï¼šå°† y çš„å·¦å„¿å­æ ‡è®°ä¸º x çš„å³å„¿å­ï¼Œx çš„å³å„¿å­æ ‡è®°ä¸º yï¼Œè‹¥ z å­˜åœ¨ï¼Œå°† z å¯¹åº”çš„å„¿å­æ ‡è®°æˆ xã€‚ï¼ˆ**çˆ¶äº²èŠ‚ç‚¹çš„ä¿¡æ¯ä¹Ÿè¦ä¸€åŒæ›´æ”¹**ï¼‰
2. æ›´æ–°ç»“ç‚¹ä¿¡æ¯ï¼šå…ˆ y å† x æœ€ååˆ° zã€‚

éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼šæ‰€æœ‰æ“ä½œéƒ½è¦**è‡³ä¸‹è€Œä¸Š**è¿›è¡Œã€‚

å·¦æ—‹åä¹‹ï¼Œä¸åšå™è¿°ã€‚

å€Ÿç”¨ä¸€å¼  OI Wiki ä¸Šçš„å›¾ç‰‡ï¼š
![](https://oi-wiki.org/ds/images/splay-zig.svg)

æ—‹è½¬çš„å®ç°ï¼ˆ$ch$ æ•°ç»„æ˜¯å·¦å³å„¿å­ï¼‰ï¼š
```cpp
void rotate(int x){
	int y=fa[x],z=fa[y],s=pd(x);
	son[y][s]=son[x][s^1];
	if(son[x][s^1])fa[son[x][s^1]]=y;
	son[x][s^1]=y;
	fa[y]=x;
	fa[x]=z;
	if(z)son[z][y==son[z][1]]=x;
	maintain(y);
	maintain(x);
}
```

é‚£æ—‹è½¬æœ‰å•¥ç”¨å•Šï¼Ÿ

åˆ«å¿˜äº†ï¼ŒSplay çš„æ ¸å¿ƒæ“ä½œæ˜¯**ä¼¸å±•æ“ä½œ**ï¼Œæ±‚æ¯è®¿é—®ä¸€ä¸ªèŠ‚ç‚¹ x éƒ½è¦å°†å…¶æ—‹è½¬åˆ°æ ¹èŠ‚ç‚¹ï¼ˆæˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼‰ã€‚

ä½†æ˜¯æˆ‘ä»¬ä¸èƒ½æ¯æ¬¡å°† x å‘ä¸Šæ—‹è½¬ä¸€å±‚ï¼Œéå¸¸å®¹æ˜“è¢«æ¯’ç˜¤æ•°æ®å¡ï¼Œè¿™æ ·çš„æ•°æ®æ„é€ ä¹Ÿä¸éš¾ï¼Œåªéœ€è¦ä½¿å¾—å¹³è¡¡æ ‘è¢«æ„é€ ä¸ºä¸€æ¡é“¾å³å¯ã€‚

æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨åˆ°**åŒæ—‹**ï¼ˆä»¥ä¸Šä»‹ç»çš„æ—‹è½¬æ“ä½œä¸ºå•æ—‹ï¼‰ã€‚

æˆ‘ä»¬è®¾å½“å‰ç»“ç‚¹æ˜¯ xï¼Œçˆ¶äº²æ˜¯ pï¼Œp çš„çˆ¶äº²æ˜¯ gï¼Œåˆ†ç±»è®¨è®ºä¸€ä¸‹ï¼š

### zig

å¯¹äº p ä¸ºæ ¹èŠ‚ç‚¹çš„æƒ…å†µï¼ˆå³ g ä¸å­˜åœ¨ï¼‰ï¼Œæˆ‘ä»¬ç›´æ¥æ—‹è½¬ x å³å¯ã€‚

![](https://cdn.luogu.com.cn/upload/image_hosting/82jhu7on.png)

### zig zig

è‹¥ x - p - g ä¸ºç›´é“¾ï¼ˆå³æ˜¯åŒä¾§å„¿å­ï¼‰ï¼Œæˆ‘ä»¬å…ˆå°† p å‘ä¸Šæ—‹è½¬ä¸€æ¬¡ï¼Œå†å°† x ä¹Ÿæ—‹è½¬ä¸€æ¬¡ã€‚

![](https://cdn.luogu.com.cn/upload/image_hosting/rs415h9o.png)

### zig zag

è‹¥ x - p - g ä¸æ˜¯ç›´é“¾ï¼Œæˆ‘ä»¬ç›´æ¥å°† x å‘ä¸Šæ—‹è½¬ä¸¤æ¬¡ã€‚

![](https://cdn.luogu.com.cn/upload/image_hosting/owi1s77t.png)


åˆ¤æ–­ä½¿ç”¨å“ªç§æ—‹è½¬çš„è¯æˆ‘ä»¬åªéœ€è¦åˆ¤æ–­æ˜¯å·¦å„¿å­è¿˜æ˜¯å³å„¿å­å³å¯ï¼Œå®ç°ä¸éš¾ï¼Œä¸æ”¾ä»£ç äº†ã€‚

## æ—¶é—´å¤æ‚åº¦

è€å¸ˆè®²äº† 40min æ„£æ˜¯æ²¡å¬æ‡‚ï¼Œåªè®°å¾—å•æ¬¡å‡æ‘Šå¤æ‚åº¦æ˜¯ 
$O(\log n)$ çš„ï¼Œå…·ä½“å¯ä»¥çœ‹ [OI Wiki](https://oi-wiki.org/ds/splay/#%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6)ã€‚

## å¹³è¡¡æ ‘æ“ä½œ
Splay å¯ä»¥å®ç°æ™®é€šå¹³è¡¡æ ‘çš„å„ç§æ“ä½œï¼Œå¤§è‡´å’Œæ™®é€šäºŒå‰æœç´¢æ ‘ä¸€æ ·ï¼Œåªå¤šäº†ä¸€æ­¥ splay åˆ°æ ¹ã€‚
1. æŸ¥æ‰¾å•ä¸ªç»“ç‚¹ï¼šæ— è®ºæŒ‰ç…§å€¼è¿˜æ˜¯æ’åæ‰¾ï¼Œåªéœ€åœ¨äºŒå‰æœç´¢æ ‘ä¸Šæ‰¾åˆ°é‚£ä¸ªç»“ç‚¹ç„¶åå°†å…¶ splay åˆ°æ ¹å°±è¡Œäº†ã€‚
2. æ’å…¥å•ä¸ªç»“ç‚¹ï¼šåªéœ€è¦åœ¨äºŒå‰æœç´¢æ ‘ä¸Šæ‰¾åˆ°å¯¹åº”ä½ç½®æ’
å…¥åå°†å…¶ splay åˆ°æ ¹ã€‚
3. åˆ é™¤å•ä¸ªç»“ç‚¹ï¼šå…ˆæ‰¾åˆ°å¯¹åº”ç»“ç‚¹ï¼Œsplay åˆ°æ ¹ï¼Œåˆ é™¤å®ƒåæˆ‘ä»¬å¾—åˆ°äº†ä¸¤æ£µ splay æ ‘ï¼Œåªéœ€å°†å³å­æ ‘çš„æƒå€¼æœ€å°çš„ç»“ç‚¹ splay åˆ°æ ¹ï¼Œå°†å·¦å­æ ‘æ’å…¥åˆ°å³å­æ ‘çš„å·¦å„¿å­ã€‚
4. æŸ¥æ’åï¼šé¢å¤–è®°å½•æ¯ä¸ªç»“ç‚¹çš„å­æ ‘å¤§å°ï¼Œç„¶åæ‰¾å•ä¸ªç»“ç‚¹çš„åŒæ—¶è®¡ç®—æ’åï¼Œè®°å¾—æŸ¥è¯¢å®Œå splay åˆ°æ ¹ã€‚
5. æŸ¥å‰é©±/åç»§ï¼šç›´æ¥åœ¨å¯¹åº”äºŒå‰æœç´¢æ ‘ä¸ŠæŸ¥è¯¢å³å¯ï¼Œè®°å¾—æœ€å splay åˆ°æ ¹ã€‚

Qï¼šä¸ºä»€ä¹ˆè¦ splay åˆ°æ ¹å•Šï¼Ÿ    
Aï¼šæˆ‘ä¸çŸ¥é“å•Šã€‚

åŒºé—´æ“ä½œæ²¡å­¦ä¼šï¼Œå›å¤´è¡¥ä¸Šã€‚

## ä»£ç 
[P3369](https://www.luogu.com.cn/problem/P3369) AC ä»£ç ï¼ˆæœ‰äº¿ç‚¹ç‚¹é•¿ï¼‰ã€‚
```cpp
#include<bits/stdc++.h>
#define int long long
#ifdef __linux__
#define getchar getchar_unlocked
#define putchar putchar_unlocked
#else
#define getchar _getchar_nolock
#define putchar _putchar_nolock
#endif
using namespace std;
namespace FastIO {
	void read(){}
	template <class T1,class ... T2> inline void read(T1 &x,T2 &... oth){
		bool pd=0;x=0;char ch=getchar();
		while(!isdigit(ch)){pd|=ch=='-';ch=getchar();}
		while(isdigit(ch)){x=(x<<3)+(x<<1)+(ch^48);ch=getchar();}
		x=pd?-x:x;
		read(oth...);
	}
	template <class T> void _write(T x){
		if(x<0){putchar('-');x=-x;}
		if(x>9) _write(x/10);
		putchar(x%10^48);
	}
	void write(){}
	template <class T1,class ... T2>
	inline void write(T1 x,T2 ...oth){_write(x);putchar('\n');write(oth...);}
	inline void endline(){putchar('\n');}
}//Orz lby 
using namespace FastIO;

const int N=100005;
int rt,tot,fa[N],ch[N][2],val[N],cnt[N],sz[N];

void maintain(int x){
	sz[x]=sz[ch[x][0]]+sz[ch[x][1]]+cnt[x];
}
bool get(int x){
	return x==ch[fa[x]][1];
}
void clear(int x){
	ch[x][0]=ch[x][1]=fa[x]=val[x]=sz[x]=cnt[x]=0;
}
void rotate(int x){
	int y=fa[x],z=fa[y],chk=get(x);
	ch[y][chk]=ch[x][chk^1];
	if(ch[x][chk^1])fa[ch[x][chk^1]]=y;
	ch[x][chk^1]=y;
	fa[y]=x;
	fa[x]=z;
	if(z)ch[z][y==ch[z][1]]=x;
	maintain(y);
	maintain(x);
}
void splay(int x){
	for(int i=fa[x];i=fa[x],i;rotate(x)){
		if(fa[i]){
			if(get(x)==get(i))rotate(i);
			else rotate(x);
		}
	}
	rt=x;
}

void ins(int k){
	if(!rt){
		val[++tot]=k;
		cnt[tot]++;
		rt=tot;
		maintain(rt);
		return;
	}
	int cur=rt,f=0;
	while(1){
		if(val[cur]==k){
			cnt[cur]++;
			maintain(cur);
			maintain(f);
			splay(cur);
			break;
		}
		f=cur;
		cur=ch[cur][val[cur]<k];
		if(!cur){
			val[++tot]=k;
			cnt[tot]++;
			fa[tot]=f;
			ch[f][val[f]<k]=tot;
			maintain(tot);
			maintain(f);
			splay(tot);
			break;
		}
	}
}
int rk(int k){
	int res=0,cur=rt;
	while(1){
		if(k<val[cur])
			cur=ch[cur][0];
		else{
			res+=sz[ch[cur][0]];
			if(!cur)return res+1;
			if(k==val[cur]){
				splay(cur);
				return res+1;
			}
			res+=cnt[cur];
			cur=ch[cur][1];
		}
	}
}
int kth(int k){
	int cur=rt;
	while(1){
		if(ch[cur][0]&&k<=sz[ch[cur][0]])
			cur=ch[cur][0];
		else{
			k-=cnt[cur]+sz[ch[cur][0]];
			if(k<=0){
				splay(cur);
				return val[cur];
			}
			cur=ch[cur][1];
		}
	}
}
int pre(){
	int cur=ch[rt][0];
	if(!cur)return cur;
	while(ch[cur][1])
		cur=ch[cur][1];
	splay(cur);
	return cur;
}
int nxt(){
	int cur=ch[rt][1];
	if(!cur)return cur;
	while(ch[cur][0])
		cur=ch[cur][0];
	splay(cur);
	return cur;
}
void del(int k){
	rk(k);
	if(cnt[rt]>1){
		cnt[rt]--;
		maintain(rt);
		return;
	}
	if(!ch[rt][0]&&!ch[rt][1]){
		clear(rt);
		rt=0;
		return;
	}
	if(!ch[rt][0]){
		int cur=rt;
		rt=ch[rt][1];
		fa[rt]=0;
		clear(cur);
		return;
	}
	if(!ch[rt][1]){
		int cur=rt;
		rt=ch[rt][0];
		fa[rt]=0;
		clear(cur);
		return;
	}
	int cur=rt,x=pre();
	fa[ch[cur][1]]=x;
	ch[x][1]=ch[cur][1];
	clear(cur);
	maintain(rt);
}
signed main(){
	
	int n,opt,x;
	read(n);
	while(n--){
		read(opt,x);
		if(opt==1)ins(x);
		else if(opt==2)del(x);
		else if(opt==3)write(rk(x));
		else if(opt==4)write(kth(x));
		else if(opt==5)ins(x),write(val[pre()]),del(x);
		else ins(x),write(val[nxt()]),del(x);
	}
	return 0;
}
```

## ç»ƒä¹ 
[ç¥ç§˜çš„é¢˜å•ã€‚](https://www.luogu.com.cn/training/811158)

ä»¥åŠ**ä¸€å®š**è¦è®°ä½æ•°ç»„è¦å¼€åˆ° $n+m$ï¼ˆ$n$ ä¸ºåˆå§‹çš„èŠ‚ç‚¹æ•°ï¼Œ$m$ ä¸ºæ“ä½œæ•°ï¼‰ï¼ï¼ï¼

## å‚è€ƒèµ„æ–™

- è€å¸ˆç»™çš„è¯¾ä»¶
- [OI Wiki](https://oi-wiki.org/ds/splay)

## ç‰¹åˆ«é¸£è°¢
- [czz](https://www.luogu.com.cn/user/58363)ï¼šæ•™ç»ƒ
- [zxx](https://www.luogu.com.cn/user/1167457)ï¼šå¸®å¿™æ•´ç†äº†é¢˜å•ã€‚
- [WL](https://www.luogu.com.cn/user/851495)ï¼šå¸®å¿™æ£€æŸ¥çº°æ¼ã€‚
